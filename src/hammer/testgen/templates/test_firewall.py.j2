"""HAMMER Generated Firewall Tests.

Assignment: {{ assignment_id }}
Phase: {{ phase }}

Tests that verify firewall port rules.
"""

import pytest


{% for test in tests %}
{% for host in test.hosts %}
{% for port in test.ports %}
@pytest.mark.{{ phase }}
def test_firewall_port_{{ port.port }}_{{ port.protocol }}_on_{{ host }}(host_{{ host }}):
    """Verify firewall allows {{ port.port }}/{{ port.protocol }} in zone {{ port.zone }} on {{ host }}."""
    cmd = host_{{ host }}.run("firewall-cmd --list-ports --zone={{ port.zone }}")
    assert cmd.rc == 0, f"Failed to query firewall on {{ host }}"
    assert "{{ port.port }}/{{ port.protocol }}" in cmd.stdout, \
        f"Port {{ port.port }}/{{ port.protocol }} should be open in zone {{ port.zone }} on {{ host }}"


{% endfor %}
{% endfor %}
{% endfor %}
